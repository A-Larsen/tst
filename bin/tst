#!/bin/bash

tstdir=/usr/local/share/tst/
cd $tstdir
templatePath=${tstdir}templates/"$1"/


# how to write a man page: 
# /opt/google/chrome/xdg-mine
# $ man man
# groff ?
helpOption(){
cat <<_HELP
NAME
       tst - a command line tool to open vim to a template for testing ideas

SYNOPSIS
       tst {language} [template]
       tst -h

COMMANDS
       language      language species the programing language you want 
                     to write your test in. It is chosen by extension 
                     name

                     Example: $ tst js
                     this will open a test for a javascript program

       template      tells tst what template you want to use. located in
                     /home/\$USER/Development/tst/\$LANGUAGE\template.
                     if no template is specified the default template is 
                     used.


OPTIONS
       -h      displays help  

SEE ALSO
    tstsave runtst mktst
    
_HELP
}

open(){
	if [[ ! -d "$1" ]]; then
		return
	fi

    cd $1
    rm -R *

    case $1 in 
        js)
            if [[ $2 == "basic_express" ]]; then
                npm install --save express
            fi
        ;;
    esac

    cat ${templatePath}/"$2" > tst."$1"
    chmod +x tst."$1"
}

# handle options/flags
if (( $# > 0 )); then
    while (( $# != 0 )); do
        case $1 in
            -h)
                helpOption | less
                exit
                # shift
            ;;
            # py|c|cpp|js|sh|pl|kts|java)
            py|c|cpp|js|sh|pl|kts|java|s|vim|lua|nasm)
                break
            ;;
            *)
                echo "argument \"${1}\" is not valid"
                exit 1
            ;;
        esac
    done
else
    echo "arguments are required"
    exit 2
fi

open $1 "basic"
nvim -S "${tstdir}/vim/tst.vim" tst."$1" 
